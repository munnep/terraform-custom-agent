#!/bin/bash
echo "--------------------- Running Terraform Pre Plan Hook ----------------------"
# Hooks are run from the /home/tfc-agent/.tfc-agent/component/terraform/runs/run-<random>/config

# example for mirroring used
# Appends to the existing terraformrc file
# /home/tfc-agent/.tfc-agent/component/terraform/runs/run-<random>/.terraformrc
# new line is required to not collide with existing contents of the file

# grep network_mirror "../.terraformrc" &>/dev/null || cat >> "../.terraformrc" << EOF

# provider_installation {
#   network_mirror {
#     url = "https://tfe3-client.aws.munnep.com/"
#   }
# }

# echo "the Home directory being used"
# echo $HOME
# echo ""
# 

# env

echo Export the value terraform version
export TF_VAR_TERRAFORM_VERSION=$(CHECKPOINT_DISABLED=true terraform version 2> /dev/null | tr '[:upper:]' '[:lower:]' | head -n 1)

echo show the value terraform version
echo $TF_VAR_TERRAFORM_VERSION

echo "-------------------- Finished Terraform Pre Plan Hook ----------------------"
